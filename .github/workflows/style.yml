name: Style Check

on:
  pull_request:
    paths:
      - '**.cpp'
      - '**.hpp'
      - '**.cc'
      - '**.h'
      - '**.f90'
      - '**.cmake'
      - '**/CMakeLists.txt'
      - 'scripts/format-all.sh'
      - '.clang-format'
      - '.fprettifyrc'
      - '.cmake-format.yaml'

jobs:
  style:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Install formatters
        run: |
          sudo apt-get update
          sudo apt-get install -y clang-format python3-pip
          pip install cmake-format fprettify

      - name: Run format-all.sh
        run: bash scripts/format-all.sh

      - name: Check for unformatted files
        run: |
          if [[ $(git status --porcelain) ]]; then
            echo "❌ Unformatted files detected. Please run scripts/format-all.sh locally and commit changes."
            git diff
            exit 1
          else
            echo "✅ All code is properly formatted."
          fi
